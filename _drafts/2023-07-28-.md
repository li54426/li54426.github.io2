---
layout: post
title:  ""
date:   2023-07-28 16:25:14 +0800
categories: default
tags: default
author: li54426
---

* content
{:toc}








#### 编程原则

- 简单性
    消除"多余的复杂性",以简单清晰的逻辑编写代码
    ·不理解的代码无法修复改进
- 可读性
    ·代码是写给人看的,而不是机器
    ·编写可维护代码的第一步是确保代码可读
- 生产力: **团队**整体工作效率非常重要 ( 强制指定格式 )





### 如何编写高质量的Go代码

- 代码格式
- 注释
- 命名规范
- 控制流程
- 错误和异常处理







#### 代码格式

- gofmt Go语言**官方**提供的工具, 能自动**格式化**为**官方统一风格**
- goimports也是Go语言**官方**提供的工具, 实际等于gofmt加上依赖包管理自动增删依赖的**包**引用、将依赖包按字母序排序并分类



#### 注释

- 多写注释
- 记得**更新**注释



#### 变量命名

- 简洁胜于冗长
    - 缩略词全大写,但当其位于变量开头且不需要导出时,使用全小写
        ·例如使用ServeHTTP而不是ServeHttp
        ·使用XMLHTTPRequest或者xmlHTTPRequest变量距离其被使用的地方越远,则需要携带越多的上下文信息
- 全局变量在其名字中需要更多的**上下文信息**, 使得在不同地方可以轻易辨认出其含义



#### 函数命名

- ·函数名不携带包名的上下文信息,因为包名和函数名总是成对出现的
- 函数名尽量简短
- 当名为foo的包某个函数返回类型Foo时,可以省略类型信息而不导致歧义
- 当名为foo的包某个函数返回类型T时(T并不是Foo),可以在函数名中加入类型信息





#### package 包名

- 只由**小写**字母组成. 不包含大写字母和下划线等字符 ( 也是 cC++的标准 )
- 简短并包含一定的上下文信息.例如schema、task等
- 不要与标准库同名.例如不要使用sync或者strings以下规则尽量满足,以标准库包名为例
- 不使用常用变量名作为包名.例如使用bufio而不是buf
- 使用**单数**而不是复数.例如使用encoding而不是encodings
- 谨慎地使用缩写,例如使用fmt在不破坏上下文的情况下比format更加简短





小结

- 线性原理,处理逻辑尽量走直线,避免复杂的嵌套分支
- 正常流程代码沿着屏幕向下移动
- 提升代码可维护性和可读性
- **故障**问题大多出现在复杂的**条件语句和循环**语句中







错误的 Wrap 和 Unwrap 

- 错误的Wrap实际上是提供了一个**error**嵌套另一个error的能力,从而生成一个error的**跟踪链**
- 在fmt.Errorf中使用:%w关键字来将一个错误关联至错误链中



panic

- 不建议在业务代码中使用panic
- 调用函数不包含 recover 会造成程序崩溃
- 若问题可以被屏蔽或解决,建议使用error代替panic当
- 程序**启动**阶段发生不可逆转的错误时,可以在init或main函数中使用panic



 recover 

- recover只能在被defer的函数
- 使用嵌套无法生效
- 只在当前goroutine生效
- defer的语句是后进先出











#### 性能分析工具pprof

- 说明希望知道应用在什么地方耗费了多少CPU、Memory
- pprof是用于可视化和分析性能分析数据的工具pprof功能简介pprof排查实战
- pprof的采样过程和原理

[wolfogre/go-pprof-practice: go pprof practice. (github.com)](https://github.com/wolfogre/go-pprof-practice)

```go
go tool pprof "http:/localhost:6060/debug/pprof/profile?seconds=10"
// flat 当前函数本身的执行耗时
// flat% flat占CPU总时间的比例
// sum%上面每一行的flat%总和
// cum指当前函数本身加上其调用函数的总耗时
// cum%cum占 CPU总时间的比例

```



- alloc_objects:程序**累计**申请的对象数
- inuse_objects:程序当前持有的对象数
- alloc_space:程序累计申请的内存大小
- inuse_space:程序当前占用的内存大小









优化方向

- 业务优化、
- 基础库优化和 
- GO 语言优化



保证优化的正确性----不能影响用户使用

- 线上请求数据录制回放
- 新旧逻辑接口数据diff



上线评估优化效果

- 关注服务监控
- 逐步放量
- 收集性能数据



依赖:**ServiceA**的功能实现依赖Service B应结果,称为ServiceA依赖ServiceB
